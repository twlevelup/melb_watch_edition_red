'use strict';

var PageView = require('../framework/page');

var TodoCollection = require('../collections/todos'),
  TodoView = require('../views/todo');

var toDoScreen = PageView.extend({

  id: 'toDo',

  template: require('../../templates/pages/toDo.hbs'),

  buttonEvents: {
    right: 'goToHomePage',
    face: 'screenClickExample',
    left: 'back'
  },

  initialize: function() {
    var self = this;

    this.todoCollection = new TodoCollection();
    this.listenTo(this.todoCollection, 'change', this.render);

    self.seedtodo();
  },

  // TODO use jquery to load a JSON file async test?
  seedtodo: function() {
    this.todoCollection.push([
      {t_task: 'Clean floor', t_status: '1'},
      {t_task: 'Something important', t_status: '2'},
      {t_task: 'Something not so important', t_status: '3'}
    ]);
  },

  screenClickExample: function() {
    this.$el.html('<div>Oh noes!</div>');
  },

  goToHomePage: function() {
    global.App.navigate('');
  },

  render: function() {

    this.$el.html(this.template());

    var todoHTML = document.createDocumentFragment();

    this.todoCollection.each(function(todo) {
      $(todoHTML).append(this.createtodoHTML(todo));
    }, this);

    this.$el.append(todoHTML);

    return this;
  },

  createtodoHTML: function(todo) {
      var view = new TodoView({
        model: todo
      });
      return view.render().el;
    }

}
);

module.exports = toDoScreen;

